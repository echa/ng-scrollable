/**
 * ngScrollable - Superamazing scrollbars for AngularJS
 * @version 0.2.1 - built on 2015-08-13
 * @link https://echa.github.io/ng-scrollable/
 * @license MIT License, Copyright (c) 2015 Alexander Eichhorn <alex@kidtsunami.com>
 */
angular.module("ngScrollable",[]).directive("ngScrollable",["$injector",function(a){"use strict";var b=a.get("$document"),c=a.get("$interval"),d=a.get("$timeout"),e=a.get("$window"),f=a.get("$parse"),g=angular.extend,h=angular.element,i=(angular.isDefined,"undefined"!=typeof e.ontouchstart),j="transform",k=e.requestAnimationFrame||e.webkitRequestAnimationFrame;["webkit","moz","o","ms"].every(function(a){var c=a+"Transform",d=b.find("body").eq(0);return"undefined"!=typeof d[0].style[c]?(j=c,!1):!0});var l={id:0,scrollX:"bottom",scrollY:"right",scrollXSlackSpace:0,scrollYSlackSpace:0,scrollXAlways:!1,scrollYAlways:!1,usePadding:!1,wheelSpeed:1,minSliderLength:10,useBothWheelAxes:!1,useKeyboard:!0,updateOnResize:!0,kineticTau:325,customContentWidth:void 0,customContentHeight:void 0,updateContentPosition:!0};return{restrict:"A",transclude:!0,template:"<div class=\"scrollable\"><div class=\"scrollable-content\" ng-transclude></div><div class='scrollable-bar scrollable-bar-x'><div class='scrollable-slider'></div></div><div class='scrollable-bar scrollable-bar-y'><div class='scrollable-slider'></div></div></div>",link:function(a,m,n){var o,p,q,r=g({},l,a.$eval(n.ngScrollable)),s=h(m.children()[0]),t={window:h(e),el:s,content:h(s.children()[0]),barX:h(s.children()[1]),barY:h(s.children()[2]),sliderX:h(h(s.children()[1]).children()[0]),sliderY:h(h(s.children()[2]).children()[0])},u=!1,v=!1,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=null,H=null,I=null,J=null,K=!1,L=!1,M=!1,N={},O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=function(a){return a.toFixed(3)+"px"},X=function(a,b,c){return Math.max(b,Math.min(a,c))},Y=function(){var a=w-3;u?(C=Math.max(r.minSliderLength,parseInt(a*a/y,10)),D=parseInt(B*(a-C)/(y-a),10),D>=a-C?D=a-C:0>D&&(D=0),t.sliderX[0].style[j]="translate3d("+W(D)+",0,0)",t.sliderX[0].style.width=W(C)):(C=D=0,t.sliderX[0].style[j]="translate3d(0,0,0)",t.sliderX[0].style.width="0")},Z=function(){var a=x-3;v?(E=Math.max(r.minSliderLength,parseInt(a*a/z,10)),F=parseInt(A*(a-E)/(z-a),10),F>=a-E?F=a-E:0>F&&(F=0),t.sliderY[0].style[j]="translate3d(0,"+W(F)+",0)",t.sliderY[0].style.height=W(E)):(F=E=0,t.sliderY[0].style[j]="translate3d(0,0,0)",t.sliderY[0].style.height="0")},$=function(){var a=r.scrollXAlways,b={left:0,width:W(w),display:u||a?"inherit":"none"};switch(r.scrollX){case"bottom":b.bottom=0,t.content[u||a?"addClass":"removeClass"]("scrollable-bottom"),t.barX[u||a?"addClass":"removeClass"]("scrollable-bottom");break;case"top":b.top=0,t.content[u||a?"addClass":"removeClass"]("scrollable-top"),t.barX[u||a?"addClass":"removeClass"]("scrollable-top")}t.barX.css(b),t.sliderX[0].style.display=u?"inherit":"none"},_=function(){var a=r.scrollYAlways,b={top:0,height:W(x),display:v||a?"inherit":"none"};switch(r.scrollY){case"right":b.right=0,t.content[v||a?"addClass":"removeClass"]("scrollable-right"),t.barY[v||a?"addClass":"removeClass"]("scrollable-right");break;case"left":b.left=0,t.content[v||a?"addClass":"removeClass"]("scrollable-left"),t.barY[v||a?"addClass":"removeClass"]("scrollable-left")}t.barY.css(b),t.sliderY[0].style.display=v?"inherit":"none"},aa=function(b,c){A=X(c,0,z-x),B=X(b,0,y-w),r.updateContentPosition&&(t.content[0].style[j]="translate3d("+W(-B)+","+W(-A)+",0)"),N.spyX&&N.spyX(a,parseInt(B,10)),N.spyY&&N.spyY(a,parseInt(A,10))},ba=function(a){u&&(aa(a,A),Y())},ca=function(a){v&&(aa(B,a),Z())},da=function(b,c){w=r.usePadding?t.el[0].clientWidth:t.el[0].offsetWidth,x=r.usePadding?t.el[0].clientHeight:t.el[0].offsetHeight,y=angular.isDefined(r.customContentWidth)?r.customContentWidth:t.content[0].scrollWidth,z=angular.isDefined(r.customContentHeight)?r.customContentHeight:t.content[0].scrollHeight,"none"!==r.scrollX&&y>w+r.scrollXSlackSpace?u=!0:(u=!1,ba(0)),"none"!==r.scrollY&&z>x+r.scrollYSlackSpace?v=!0:(v=!1,ca(0)),$(),_(),Y(),Z(),c||a.$broadcast("scrollable.dimensions",w,x,y,z,r.id)},ea=function(a,b){return a.stopPropagation(),b&&a.preventDefault(),!1},fa=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageY:a.pageY},ga=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageX:a.pageX},ha=function(){var a,b,c,d;a=Date.now(),b=a-p,p=a,c=B-Q,Q=B,d=1e3*c/(1+b),O=.8*d+.2*O,c=A-U,U=A,d=1e3*c/(1+b),S=.8*d+.2*S},ia=function(){var a,b;P&&(a=Date.now()-p,b=-P*Math.exp(-a/r.kineticTau),b>.5||-.5>b?(ba(R+b),k(ia)):ba(R))},ja=function(){var a,b;T&&(a=Date.now()-p,b=-T*Math.exp(-a/r.kineticTau),b>.5||-.5>b?(ca(V+b),k(ja)):ca(V))},ka=function(a){return H=ga(a),G=B,K=!0,O=P=0,Q=B,q||(q=c(ha,100)),t.el.addClass("active"),i||ea(a,!i)},la=function(a){if(K){var b=ga(a)-H,c=i?-b:parseInt(b*(y-w)/(w-C),10);return ba(G+c),i||ea(a,!0)}},ma=function(a){return K&&(K=!1,t.el.removeClass("active"),G=H=null),q&&(c.cancel(q),q=null),(O>10||-10>O)&&(P=.8*O,R=Math.round(B+P),p=Date.now(),k(ia)),i||ea(a,!i)},na=function(a){return J=fa(a),I=A,L=!0,S=T=0,U=A,q||(q=c(ha,100)),t.el.addClass("active"),i||ea(a,!i)},oa=function(a){if(L){var b=fa(a)-J,c=i?-b:parseInt(b*(z-x)/(x-E),10);return ca(I+c),i||ea(a,!0)}},pa=function(a){return L&&(L=!1,t.el.removeClass("active"),I=J=null),q&&(c.cancel(q),q=null),(S>10||-10>S)&&(T=.8*S,V=Math.round(A+T),p=Date.now(),k(ja)),i||ea(a,!0)},qa=function(b){var c=parseInt(C/2,10),d=b.clientX-t.barX[0].getBoundingClientRect().left-c,e=w-C,f=X(d/e,0,1);ba((y-w)*f),a.$digest()},ra=function(b){var c=parseInt(E/2,10),d=b.clientY-t.barY[0].getBoundingClientRect().top-c,e=x-E,f=X(d/e,0,1);ca((z-x)*f),a.$digest()},sa=function(){M=!0},ta=function(){M=!1},ua=function(c){var d=0,e=0,f=30;if(!(!M||b[0].activeElement.isContentEditable||c.altKey||c.ctrlKey||c.metaKey)){switch(c.which){case 37:d=-f;break;case 38:e=f;break;case 39:d=f;break;case 40:e=-f;break;case 33:e=x;break;case 32:case 34:e=-x;break;case 35:v&&!u?e=-z:d=x;break;case 36:v&&!u?e=z:d=-x;break;default:return}ca(A-e),ba(B+d),c.preventDefault(),a.$digest()}},va=function(b){b=b.originalEvent||b;var c=b.deltaX*r.wheelSpeed,e=b.deltaY*r.wheelSpeed;t.el.addClass("active"),d.cancel(o),o=d(function(){t.el.removeClass("active")},500),r.useBothWheelAxes?v&&!u?ca(e?A+e:A+c):u&&!v&&ba(c?B+c:B+e):(ca(A+e),ba(B+c)),ea(b,!0),a.$digest()},wa=function(){r.updateOnResize&&t.window.on("resize",da),"none"!==r.scrollX&&(t.sliderX.on("click",ea),t.barX.on("click",qa),i?(t.el.on("touchstart",ka),t.el.on("touchmove",la),t.el.on("touchend",ma)):(t.sliderX.on("mousedown",ka),b.on("mousemove",la),b.on("mouseup",ma))),"none"!==r.scrollY&&(t.sliderY.on("click",ea),t.barY.on("click",ra),i?(t.el.on("touchstart",na),t.el.on("touchmove",oa),t.el.on("touchend",pa)):(t.sliderY.on("mousedown",na),b.on("mousemove",oa),b.on("mouseup",pa))),i||t.el.on("wheel",va),r.useKeyboard&&!i&&(t.el.on("mouseenter",sa),t.el.on("mouseleave",ta),b.on("keydown",ua))},xa=function(){r.updateOnResize&&t.window.off("resize",da),t.sliderX.off("click",ea),t.barX.off("click",qa),t.sliderY.off("click",ea),t.barY.off("click",ra),i?(t.el.off("touchstart",ka),t.el.off("touchmove",la),t.el.off("touchend",ma),t.el.off("touchstart",na),t.el.off("touchmove",oa),t.el.off("touchend",pa)):(t.sliderX.off("mousedown",ka),b.off("mousemove",la),b.off("mouseup",ma),t.sliderY.off("mousedown",na),b.off("mousemove",oa),b.off("mouseup",pa),r.useKeyboard&&(t.el.off("mouseenter",sa),t.el.off("mouseleave",ta),b.off("keydown",ua)),t.el.off("wheel",va))};a.$on("content.reload",function(a,b){xa(),d(function(){t.el=h(m.children()[0]),t.content=h(t.el.children()[0]),wa(),da(a,b)})}),a.$on("content.changed",function(a,b,c){b=b||100,d(function(){da(a,c)},b),a.preventDefault()}),a.$on("scrollable.scroll.left",function(){a.$applyAsync(function(){ba(0)})}),a.$on("scrollable.scroll.right",function(){a.$applyAsync(function(){ba(y)})}),a.$on("scrollable.scroll.top",function(){a.$applyAsync(function(){ca(0)})}),a.$on("scrollable.scroll.bottom",function(){a.$applyAsync(function(){ca(z)})}),a.$on("$destroy",function(){d.cancel(o),xa()}),wa(),da(),angular.forEach(["spyX","spyY"],function(b){n[b]&&(N[b]=f(n[b]).assign,a.$watch(n[b],function(a){switch(b){case"spyX":ba(a);break;case"spyY":ca(a)}}))})}}}]);