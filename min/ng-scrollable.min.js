/**
 * ngScrollable - Superamazing scrollbars for AngularJS
 * @version 0.2.2 - built on 2015-11-13
 * @link https://echa.github.io/ng-scrollable/
 * @license MIT License, Copyright (c) 2015 Alexander Eichhorn <alex@kidtsunami.com>
 */
angular.module("ngScrollable",[]).directive("ngScrollable",["$injector",function(a){"use strict";var b=a.get("$document"),c=a.get("$interval"),d=a.get("$timeout"),e=a.get("$window"),f=a.get("$parse"),g=angular.extend,h=angular.element,i=(angular.isDefined,"undefined"!=typeof e.ontouchstart),j="transform",k=e.requestAnimationFrame||e.webkitRequestAnimationFrame,l=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;["webkit","moz","o","ms"].every(function(a){var c=a+"Transform",d=b.find("body").eq(0);return"undefined"!=typeof d[0].style[c]?(j=c,!1):!0});var m={id:0,scrollX:"bottom",scrollY:"right",scrollXSlackSpace:0,scrollYSlackSpace:0,scrollXAlways:!1,scrollYAlways:!1,usePadding:!1,useObserver:!0,wheelSpeed:1,minSliderLength:10,useBothWheelAxes:!1,useKeyboard:!0,preventKeyEvents:!0,updateOnResize:!0,kineticTau:325};return{restrict:"A",transclude:!0,template:"<div class=\"scrollable\"><div class=\"scrollable-content\" ng-transclude></div><div class='scrollable-bar scrollable-bar-x'><div class='scrollable-slider'></div></div><div class='scrollable-bar scrollable-bar-y'><div class='scrollable-slider'></div></div></div>",link:function(a,n,o){var p,q,r,s,t=g({},m,a.$eval(o.ngScrollable)),u=h(n.children()[0]),v={window:h(e),el:u,content:h(u.children()[0]),barX:h(u.children()[1]),barY:h(u.children()[2]),sliderX:h(h(u.children()[1]).children()[0]),sliderY:h(h(u.children()[2]).children()[0])},w=!1,x=!1,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=null,J=null,K=null,L=null,M=!1,N=!1,O=!1,P={},Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=function(a){return a.toFixed(3)+"px"},Z=function(a,b,c){return Math.max(b,Math.min(a,c))},$=function(){var a=y-3;w?(E=Math.max(t.minSliderLength,parseInt(a*a/A,10)),F=parseInt(D*(a-E)/(A-a),10),F>=a-E?F=a-E:0>F&&(F=0),v.sliderX[0].style[j]="translate3d("+Y(F)+",0,0)",v.sliderX[0].style.width=Y(E)):(E=F=0,v.sliderX[0].style[j]="translate3d(0,0,0)",v.sliderX[0].style.width="0")},_=function(){var a=z-3;x?(G=Math.max(t.minSliderLength,parseInt(a*a/B,10)),H=parseInt(C*(a-G)/(B-a),10),H>=a-G?H=a-G:0>H&&(H=0),v.sliderY[0].style[j]="translate3d(0,"+Y(H)+",0)",v.sliderY[0].style.height=Y(G)):(H=G=0,v.sliderY[0].style[j]="translate3d(0,0,0)",v.sliderY[0].style.height="0")},aa=function(){var a=t.scrollXAlways,b={left:0,width:Y(y),display:w||a?"inherit":"none"};switch(t.scrollX){case"bottom":b.bottom=0,v.content[w||a?"addClass":"removeClass"]("scrollable-bottom"),v.barX[w||a?"addClass":"removeClass"]("scrollable-bottom");break;case"top":b.top=0,v.content[w||a?"addClass":"removeClass"]("scrollable-top"),v.barX[w||a?"addClass":"removeClass"]("scrollable-top")}v.barX.css(b),v.sliderX[0].style.display=w?"inherit":"none"},ba=function(){var a=t.scrollYAlways,b={top:0,height:Y(z),display:x||a?"inherit":"none"};switch(t.scrollY){case"right":b.right=0,v.content[x||a?"addClass":"removeClass"]("scrollable-right"),v.barY[x||a?"addClass":"removeClass"]("scrollable-right");break;case"left":b.left=0,v.content[x||a?"addClass":"removeClass"]("scrollable-left"),v.barY[x||a?"addClass":"removeClass"]("scrollable-left")}v.barY.css(b),v.sliderY[0].style.display=x?"inherit":"none"},ca=function(b,c){C=Z(c,0,B-z),D=Z(b,0,A-y),v.content[0].style[j]="translate3d("+Y(-D)+","+Y(-C)+",0)",P.spyX&&P.spyX(a,parseInt(D,10)),P.spyY&&P.spyY(a,parseInt(C,10))},da=function(a){w&&(ca(a,C),$())},ea=function(a){x&&(ca(D,a),_())},fa=function(b,c){y=t.usePadding?v.el[0].clientWidth:v.el[0].offsetWidth,z=t.usePadding?v.el[0].clientHeight:v.el[0].offsetHeight,A=v.content[0].scrollWidth,B=v.content[0].scrollHeight,"none"!==t.scrollX&&A>y+t.scrollXSlackSpace?w=!0:(da(0),w=!1),"none"!==t.scrollY&&B>z+t.scrollYSlackSpace?x=!0:(ea(0),x=!1),aa(),ba(),$(),_(),D+F+E>A&&da(F),C+H+G>B&&ea(H),c||a.$broadcast("scrollable.dimensions",y,z,A,B,t.id)},ga=function(a,b){return a.stopPropagation(),b&&a.preventDefault(),!1},ha=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageY:a.pageY},ia=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageX:a.pageX},ja=function(){var a,b,c,d;a=Date.now(),b=a-r,r=a,c=D-S,S=D,d=1e3*c/(1+b),Q=.8*d+.2*Q,c=C-W,W=C,d=1e3*c/(1+b),U=.8*d+.2*U},ka=function(){var a,b;R&&(a=Date.now()-r,b=-R*Math.exp(-a/t.kineticTau),b>.5||-.5>b?(da(T+b),k(ka)):da(T))},la=function(){var a,b;V&&(a=Date.now()-r,b=-V*Math.exp(-a/t.kineticTau),b>.5||-.5>b?(ea(X+b),k(la)):ea(X))},ma=function(a){return J=ia(a),I=D,M=!0,Q=R=0,S=D,s||(s=c(ja,100)),v.el.addClass("active"),i||ga(a,!i)},na=function(a){if(M){var b=ia(a)-J,c=i?-b:parseInt(b*(A-y)/(y-E),10);return da(I+c),ga(a,!0)}},oa=function(a){return M&&(M=!1,v.el.removeClass("active"),I=J=null),s&&(c.cancel(s),s=null),(Q>10||-10>Q)&&(R=.8*Q,T=Math.round(D+R),r=Date.now(),k(ka)),i||ga(a,!i)},pa=function(a){return L=ha(a),K=C,N=!0,U=V=0,W=C,s||(s=c(ja,100)),v.el.addClass("active"),i||ga(a,!i)},qa=function(a){if(N){var b=ha(a)-L,c=i?-b:parseInt(b*(B-z)/(z-G),10);return ea(K+c),ga(a,!0)}},ra=function(a){return N&&(N=!1,v.el.removeClass("active"),K=L=null),s&&(c.cancel(s),s=null),(U>10||-10>U)&&(V=.8*U,X=Math.round(C+V),r=Date.now(),k(la)),i||ga(a,!0)},sa=function(b){var c=parseInt(E/2,10),d=b.clientX-v.barX[0].getBoundingClientRect().left-c,e=y-E,f=Z(d/e,0,1);da((A-y)*f),a.$digest()},ta=function(b){var c=parseInt(G/2,10),d=b.clientY-v.barY[0].getBoundingClientRect().top-c,e=z-G,f=Z(d/e,0,1);ea((B-z)*f),a.$digest()},ua=function(){O=!0},va=function(){O=!1},wa=function(c){var d=0,e=0,f=30;if(!(!O||b[0].activeElement.isContentEditable||"INPUT"===b[0].activeElement.nodeName||c.altKey||c.ctrlKey||c.metaKey)){switch(c.which){case 37:d=-f;break;case 38:e=f;break;case 39:d=f;break;case 40:e=-f;break;case 33:e=z;break;case 32:case 34:e=-z;break;case 35:x&&!w?e=-B:d=z;break;case 36:x&&!w?e=B:d=-z;break;default:return}ea(C-e),da(D+d),t.preventKeyEvents&&c.preventDefault(),a.$digest()}},xa=function(b){b=b.originalEvent||b;var c=b.deltaX*t.wheelSpeed,e=b.deltaY*t.wheelSpeed;v.el.addClass("active"),d.cancel(q),q=d(function(){v.el.removeClass("active")},500),t.useBothWheelAxes?x&&!w?ea(e?C+e:C+c):w&&!x&&da(c?D+c:D+e):(ea(C+e),da(D+c)),ga(b,!0),a.$digest()},ya=function(){if(t.useObserver&&l){var a={childList:!0,subtree:!0};p=new l(function(){k(fa)}),p.observe(v.content[0],a)}t.updateOnResize&&v.window.on("resize",fa),"none"!==t.scrollX&&(v.sliderX.on("click",ga),v.barX.on("click",sa),i?(v.el.on("touchstart",ma),v.el.on("touchmove",na),v.el.on("touchend",oa)):(v.sliderX.on("mousedown",ma),b.on("mousemove",na),b.on("mouseup",oa))),"none"!==t.scrollY&&(v.sliderY.on("click",ga),v.barY.on("click",ta),i?(v.el.on("touchstart",pa),v.el.on("touchmove",qa),v.el.on("touchend",ra)):(v.sliderY.on("mousedown",pa),b.on("mousemove",qa),b.on("mouseup",ra))),i||v.el.on("wheel",xa),t.useKeyboard&&!i&&(v.el.on("mouseenter",ua),v.el.on("mouseleave",va),b.on("keydown",wa))},za=function(){p&&(p.disconnect(),p=null),t.updateOnResize&&v.window.off("resize",fa),v.sliderX.off("click",ga),v.barX.off("click",sa),v.sliderY.off("click",ga),v.barY.off("click",ta),i?(v.el.off("touchstart",ma),v.el.off("touchmove",na),v.el.off("touchend",oa),v.el.off("touchstart",pa),v.el.off("touchmove",qa),v.el.off("touchend",ra)):(v.sliderX.off("mousedown",ma),b.off("mousemove",na),b.off("mouseup",oa),v.sliderY.off("mousedown",pa),b.off("mousemove",qa),b.off("mouseup",ra),t.useKeyboard&&(v.el.off("mouseenter",ua),v.el.off("mouseleave",va),b.off("keydown",wa)),v.el.off("wheel",xa))};a.$on("content.reload",function(a,b){za(),d(function(){v.el=h(n.children()[0]),v.content=h(v.el.children()[0]),ya(),fa(a,b)})}),a.$on("content.changed",function(a,b,c){b=b||100,d(function(){fa(a,c)},b),a.preventDefault()}),a.$on("scrollable.scroll.left",function(){a.$applyAsync(function(){da(0)})}),a.$on("scrollable.scroll.right",function(){a.$applyAsync(function(){da(A)})}),a.$on("scrollable.scroll.top",function(){a.$applyAsync(function(){ea(0)})}),a.$on("scrollable.scroll.bottom",function(){a.$applyAsync(function(){ea(B)})}),a.$on("$destroy",function(){d.cancel(q),za()}),ya(),fa(),angular.forEach(["spyX","spyY"],function(b){o[b]&&(P[b]=f(o[b]).assign,a.$watch(o[b],function(a){switch(b){case"spyX":da(a);break;case"spyY":ea(a)}}))})}}}]);