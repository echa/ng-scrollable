/**
 * ngScrollable - Superamazing scrollbars for AngularJS
 * @version 0.2.5 - built on 2016-04-06
 * @link https://echa.github.io/ng-scrollable/
 * @license MIT License, Copyright (c) 2016 Alexander Eichhorn <alex@kidtsunami.com>
 */
angular.module("ngScrollable",[]).directive("ngScrollable",["$injector",function(a){"use strict";var b=a.get("$document"),c=a.get("$interval"),d=a.get("$timeout"),e=a.get("$window"),f=a.get("$parse"),g=angular.bind,h=angular.extend,i=angular.element,k=(angular.isDefined,"undefined"!=typeof e.ontouchstart),l="transform",m=e.requestAnimationFrame||e.webkitRequestAnimationFrame,n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;["webkit","moz","o","ms"].every(function(a){var c=a+"Transform",d=b.find("body").eq(0);return"undefined"==typeof d[0].style[c]||(l=c,!1)});var o={id:0,scrollX:"bottom",scrollY:"right",scrollXSlackSpace:0,scrollYSlackSpace:0,scrollXAlways:!1,scrollYAlways:!1,usePadding:!1,useObserver:!0,wheelSpeed:1,minSliderLength:10,useBothWheelAxes:!1,useKeyboard:!0,preventKeyEvents:!0,preventWheelEvents:!1,updateOnResize:!0,kineticTau:325,spyMargin:1};return{restrict:"A",transclude:!0,template:"<div class=\"scrollable\"><div class=\"scrollable-content\" ng-transclude></div><div class='scrollable-bar scrollable-bar-x'><div class='scrollable-slider'></div></div><div class='scrollable-bar scrollable-bar-y'><div class='scrollable-slider'></div></div></div>",link:function(a,j,p){var t,N,Y,Z,$,q=h({},o,a.$eval(p.ngScrollable)),r=i(j.children()[0]),s={window:i(e),el:r,content:i(r.children()[0]),barX:i(r.children()[1]),barY:i(r.children()[2]),sliderX:i(i(r.children()[1]).children()[0]),sliderY:i(i(r.children()[2]).children()[0])},u=!1,v=!1,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=null,H=null,I=null,J=null,K=!1,L=!1,M=!1,O={},P=1,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,_=function(a){return a.toFixed(3)+"px"},aa=function(a,b,c){return Math.max(b,Math.min(a,c))},ba=function(){var b=a.$root?a.$root.$$phase:a.$$phase;"$apply"!==b&&"$digest"!==b&&a.$digest()},ca=function(){var a=w-3;u||q.scrollXAlways?(C=Math.max(q.minSliderLength,parseInt(a*a/y,10)),D=parseInt(B*(a-C)/(y-a),10),D>=a-C?D=a-C:D<0&&(D=0),s.sliderX[0].style[l]="translate3d("+_(D)+",0,0)",s.sliderX[0].style.width=_(C)):(C=D=0,s.sliderX[0].style[l]="translate3d(0,0,0)",s.sliderX[0].style.width="0")},da=function(){var a=x-3;v||q.scrollYAlways?(E=Math.max(q.minSliderLength,parseInt(a*a/z,10)),F=parseInt(A*(a-E)/(z-a),10),F>=a-E?F=a-E:F<0&&(F=0),s.sliderY[0].style[l]="translate3d(0,"+_(F)+",0)",s.sliderY[0].style.height=_(E)):(F=E=0,s.sliderY[0].style[l]="translate3d(0,0,0)",s.sliderY[0].style.height="0")},ea=function(){var a=q.scrollXAlways,b={left:0,width:_(w),display:u||a?"inherit":"none"};switch(q.scrollX){case"bottom":b.bottom=0,s.content[u||a?"addClass":"removeClass"]("scrollable-bottom"),s.barX[u||a?"addClass":"removeClass"]("scrollable-bottom");break;case"top":b.top=0,s.content[u||a?"addClass":"removeClass"]("scrollable-top"),s.barX[u||a?"addClass":"removeClass"]("scrollable-top")}s.barX.css(b),s.sliderX[0].style.display=u||a?"inherit":"none"},fa=function(){var a=q.scrollYAlways,b={top:0,height:_(x),display:v||a?"inherit":"none"};switch(q.scrollY){case"right":b.right=0,s.content[v||a?"addClass":"removeClass"]("scrollable-right"),s.barY[v||a?"addClass":"removeClass"]("scrollable-right");break;case"left":b.left=0,s.content[v||a?"addClass":"removeClass"]("scrollable-left"),s.barY[v||a?"addClass":"removeClass"]("scrollable-left")}s.barY.css(b),s.sliderY[0].style.display=v||a?"inherit":"none"},ga=function(){var b=!1;O.spyX&&(O.spyX(a,parseInt(B,10)),b=!0),O.spyY&&(O.spyY(a,parseInt(A,10)),b=!0),b&&ba()},ha=function(b,c){var d=A,e=B;A=aa(c,0,z-x),B=aa(b,0,y-w),s.content[0].style[l]="translate3d("+_(-B)+","+_(-A)+",0)",a.$applyAsync(ga),A<x*q.spyMargin&&d>=x*q.spyMargin&&a.$emit("scrollable.spytop",A,q.id),A>z-x*(q.spyMargin+1)&&d<=z-x*(q.spyMargin+1)&&a.$emit("scrollable.spybottom",A,q.id),B<w*q.spyMargin&&e>=w*q.spyMargin&&a.$emit("scrollable.spyleft",B,q.id),B>y-w*(q.spyMargin+1)&&e<=y-w*(q.spyMargin+1)&&a.$emit("scrollable.spyright",B,q.id)},ia=function(a){u&&(ha(a,A),ca())},ja=function(a){v&&(ha(B,a),da())},ka=function(b,c){w=q.usePadding?s.el[0].clientWidth:s.el[0].offsetWidth,x=q.usePadding?s.el[0].clientHeight:s.el[0].offsetHeight,y=s.content[0].scrollWidth,z=s.content[0].scrollHeight,P=parseFloat(s.window[0].getComputedStyle(s.el[0],null).getPropertyValue("font-size")),"none"!==q.scrollX&&w+q.scrollXSlackSpace<y?u=!0:(ia(0),u=!1),"none"!==q.scrollY&&x+q.scrollYSlackSpace<z?v=!0:(ja(0),v=!1),ea(),fa(),ca(),da(),y<B+D+C&&ia(D),z<A+F+E&&ja(F),c||a.$broadcast("scrollable.dimensions",w,x,y,z,q.id)},la=function(a,b){return a.stopPropagation(),b&&a.preventDefault(),!1},ma=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageY:a.pageY},na=function(a){return a=a.originalEvent||a,a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].pageX:a.pageX},oa=function(){var a,b,c,d;a=Date.now(),b=a-Z,Z=a,c=B-S,S=B,d=1e3*c/(1+b),Q=.8*d+.2*Q,c=A-W,W=A,d=1e3*c/(1+b),U=.8*d+.2*U},pa=function(){var a,b;R&&(a=Date.now()-Z,b=-R*Math.exp(-a/q.kineticTau),b>.5||b<-.5?(ia(T+b),m(pa)):ia(T))},qa=function(){var a,b;V&&(a=Date.now()-Z,b=-V*Math.exp(-a/q.kineticTau),b>.5||b<-.5?(ja(X+b),m(qa)):ja(X))},ra=function(a){return H=na(a),G=B,K=!0,Q=R=0,S=B,b.on("mousemove",sa),b.on("mouseup",ta),k&&!$&&($=c(oa,50)),s.el.addClass("active"),k||la(a,!0)},sa=function(a){if(K){var b=na(a)-H,c=k?-b:parseInt(b*(y-w)/(w-C),10);return m(g(null,ia,G+c)),k||la(a,!0)}},ta=function(a){return K&&(b.off("mousemove",sa),b.off("mouseup",ta),K=!1,s.el.removeClass("active"),G=H=null),$&&(c.cancel($),$=null),(Q>10||Q<-10)&&(R=.8*Q,T=Math.round(B+R),Z=Date.now(),m(pa)),k||la(a,!0)},ua=function(a){return J=ma(a),I=A,L=!0,U=V=0,W=A,b.on("mousemove",va),b.on("mouseup",wa),k&&!$&&($=c(oa,50)),s.el.addClass("active"),k||la(a,!0)},va=function(a){if(L){var b=ma(a)-J,c=k?-b:parseInt(b*(z-x)/(x-E),10);return m(g(null,ja,I+c)),k||la(a,!0)}},wa=function(a){return L&&(b.off("mousemove",va),b.off("mouseup",wa),L=!1,s.el.removeClass("active"),I=J=null),$&&(c.cancel($),$=null),(U>10||U<-10)&&(V=.8*U,X=Math.round(A+V),Z=Date.now(),m(qa)),k||la(a,!0)},xa=function(a){var b=parseInt(C/2,10),c=a.clientX-s.barX[0].getBoundingClientRect().left-b,d=w-C,e=aa(c/d,0,1);m(g(null,ia,(y-w)*e))},ya=function(a){var b=parseInt(E/2,10),c=a.clientY-s.barY[0].getBoundingClientRect().top-b,d=x-E,e=aa(c/d,0,1);m(g(null,ja,(z-x)*e))},za=function(){M=!0},Aa=function(){M=!1},Ba=function(a){var c=0,d=0,e=30;if(!(!M||b[0].activeElement.isContentEditable||"INPUT"===b[0].activeElement.nodeName||a.altKey||a.ctrlKey||a.metaKey)){switch(a.which){case 37:c=-e;break;case 38:d=e;break;case 39:c=e;break;case 40:d=-e;break;case 33:d=x;break;case 32:case 34:d=-x;break;case 35:v&&!u?d=-z:c=x;break;case 36:v&&!u?d=z:c=-x;break;default:return}m(g(null,ja,A-d)),m(g(null,ia,B+c)),q.preventKeyEvents&&a.preventDefault()}},Ca=function(a){var b=a.explicitOriginalTarget||a.target;if(!b)return!1;if(b.isContentEditable)return b.scrollHeight>b.clientHeight+b.clientTop+10;for(;b;){if(b.className&&"string"==typeof b.className&&b.className.indexOf("scrollable-ignore")>-1)return!0;b=b.parentNode}return!1},Da=function(){var a=Date.now()-Y;a<500?N=d(Da,500-a):(s.el.removeClass("active"),N=null)},Ea=function(a){return B+a<=0||B+a>=y-w},Fa=function(a){return A+a<=0||A+a>=z-x},Ga=function(a){if(a=a.originalEvent||a,!Ca(a)){var b=a.deltaMode?P:1,c=a.deltaX*b*q.wheelSpeed,e=a.deltaY*b*q.wheelSpeed,f=v||u;if(a.shiftKey){var h=e;e=c,c=h}Y=Date.now(),N||(s.el.addClass("active"),N=d(Da,500)),q.useBothWheelAxes?v&&!u?e?(m(g(null,ja,A+e)),f=!Fa(e)):(m(g(null,ja,A+c)),f=!Fa(c)):u&&!v&&(c?(m(g(null,ia,B+c)),f=!Ea(c)):(m(g(null,ia,B+e)),f=!Ea(e))):(m(g(null,ja,A+e)),m(g(null,ia,B+c)),v&&(f=!Fa(0))),(f||q.preventWheelEvents)&&la(a,!0)}},Ha=function(a){var b=s.el[0].scrollTop,c=s.el[0].scrollLeft;b&&m(g(null,ja,A+b+2)),c&&m(g(null,ia,B+c+2)),s.el[0].scrollTop=s.el[0].scrollLeft=0,la(a,!0)},Ia=function(){if(q.useObserver&&n){var a={childList:!0,subtree:!0};t=new n(function(){m(ka)}),t.observe(s.content[0],a)}q.updateOnResize&&s.window.on("resize",ka),"none"!==q.scrollX&&(s.sliderX.on("click",la),s.barX.on("click",xa),s.sliderX.on("mousedown",ra),k&&(s.el.on("touchstart",ra),s.el.on("touchmove",sa),s.el.on("touchend",ta))),"none"!==q.scrollY&&(s.sliderY.on("click",la),s.barY.on("click",ya),s.sliderY.on("mousedown",ua),k&&(s.el.on("touchstart",ua),s.el.on("touchmove",va),s.el.on("touchend",wa))),s.el.on("wheel",Ga),s.el.on("scroll",Ha),q.useKeyboard&&(s.el.on("mouseenter",za),s.el.on("mouseleave",Aa),b.on("keydown",Ba))},Ja=function(){t&&(t.disconnect(),t=null),q.updateOnResize&&s.window.off("resize",ka),s.sliderX.off("click",la),s.barX.off("click",xa),s.sliderY.off("click",la),s.barY.off("click",ya),k&&(s.el.off("touchstart",ra),s.el.off("touchmove",sa),s.el.off("touchend",ta),s.el.off("touchstart",ua),s.el.off("touchmove",va),s.el.off("touchend",wa)),s.sliderX.off("mousedown",ra),b.off("mousemove",sa),b.off("mouseup",ta),s.sliderY.off("mousedown",ua),b.off("mousemove",va),b.off("mouseup",wa),q.useKeyboard&&(s.el.off("mouseenter",za),s.el.off("mouseleave",Aa),b.off("keydown",Ba)),s.el.off("wheel",Ga),s.el.off("scroll",Ha)};a.$on("content.reload",function(a,b){Ja(),d(function(){s.el=i(j.children()[0]),s.content=i(s.el.children()[0]),Ia(),ka(a,b)})}),a.$on("content.changed",function(a,b,c){b=b||100,d(function(){ka(a,c)},b),a.preventDefault()}),a.$on("scrollable.scroll.left",function(){a.$applyAsync(function(){ia(0)})}),a.$on("scrollable.scroll.right",function(){a.$applyAsync(function(){ia(y)})}),a.$on("scrollable.scroll.top",function(){a.$applyAsync(function(){ja(0)})}),a.$on("scrollable.scroll.bottom",function(){a.$applyAsync(function(){ja(z)})}),a.$on("$destroy",function(){d.cancel(N),Ja()}),Ia(),ka(),angular.forEach(["spyX","spyY"],function(b){p[b]&&(O[b]=f(p[b]).assign,a.$watch(p[b],function(a){switch(a=a||0,b){case"spyX":ia(a);break;case"spyY":ja(a)}}))})}}}]);
